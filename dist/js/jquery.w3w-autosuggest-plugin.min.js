/*!
 * what3words autosuggest jQuery plugin
 * Copyright (C) 2017 what3words Limited
 * Licensed under the MIT license
 *
 * @author what3words
 * @version 1.3.0
 * @link https://github.com/what3words/jquery-plugin-w3w-autosuggest
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";var t="w3wAddress",n=function(n,o){this._api_end_point="https://api.what3words.com/v2/",this.element=n,this._name=t,this._defaults=e.fn.w3wAddress.defaults,this.options=e.extend({},this._defaults,o),this.init()};e.extend(n.prototype,{init:function(){this.buildWrappers(),this.autoSuggest(),this.validation()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildWrappers:function(){var t=this.options.direction;e(this.element).wrapAll('<div class="typeahead__container '+t+'"><div class="typeahead__field"><span class="typeahead__query"></span></div></div>'),this.options.logo&&(e(this.element).addClass("typeahead__padlogo"),e(this.element).closest(".typeahead__container").prepend('<img class="typeahead__w3w-logo" src="https://assets.prod.what3words.com/images/w3w_grid-logo.svg" alt="w3w-logo">')),this.options.validation&&e(this.element).closest(".typeahead__container").after('<div class="typeahead__w3w_validation"></div>'),e(this.element).addClass("typeahead__w3w_valid").attr("placeholder",this.options.placeholder+" ").attr("autocomplete","off").attr("dir","auto").attr("aria-invalid","true")},bindEvents:function(){},unbindEvents:function(){this.$element.off("."+this._name)},callback:function(){var e=this.options.onComplete;"function"==typeof e&&e.call(this.element)},autoSuggest:function(){var t=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i;""===this.options.key&&this.options.debug?(console.log("No what3words API key found!"),alert("A what3words API key is required to use the AutoSuggest plugin. Information on how to register for a key can be found in the README")):this.options.debug&&console.log("what3words API key: "+this.options.key),"ar"===this.options.lang&&e(this.element).css("direction","rtl");var n,o=this,a=0;e.typeahead({debug:!0,input:e(this.element),minLength:5,compression:!0,hint:!0,emptyTemplate:!1,dynamic:!0,delay:700,maxItem:20,source:{autosuggest:{filter:function(t,n){var i=null;return null!==o.options.country_filter&&(e(o.options.country_filter).get(0)?(i=e(o.options.country_filter).val(),i="string"==typeof i?i.toLowerCase():null,"string"==typeof i&&2===i.length||(i=null)):"string"==typeof o.options.country_filter&&2===o.options.country_filter.length&&(i=o.options.country_filter.toLowerCase())),null!==i?(o.options.debug&&(console.log("w3wAddress country_filter: "),console.log(e(o.options.country_filter)),console.log("Selected Country is: "+i),console.log("#################################")),t.country===i&&(a<o.options.results&&(a++,!0))):a<o.options.results?(a++,!0):void 0},display:["words"],template:function(e,t){return['<div class="typeahead__list-inner">','<span class="typeahead__twa-flag w3w-flags-{{country}}">',"</span>",'<span class="typeahead__twa">{{words}}</span>',"<br>",'<span class="typeahead__info">',"{{place}}","</span>","</div>"].join("\n")},ajax:function(e){var n=t.exec(e);if(null!==n){var a={addr:"{{query}}",format:"json",key:o.options.key,count:o.options.count,display:"full"};"undefined"!=typeof o.options.lang&&o.options.lang&&(a.lang=o.options.lang),o.options.multilingual||"undefined"!=typeof a.lang||(a.lang="en");var i=o.options.multilingual?"autosuggest-ml":"autosuggest";return{type:"GET",url:o._api_end_point+i,data:a,path:"suggestions"}}return!1}}},callback:{onSearch:function(t,n){a=0,e(o.element).attr("aria-invalid",!0)},onInit:function(e){o.options.debug&&console.log("w3wAddress typeahead initiated on field: "+e.selector)},onResult:function(e,t,n,a){if(""!==t){var i="";0===n.length?i='No results matching "'+t+'"':n.length>0&&n.length<a?i="Showing "+n.length+" of "+a+' elements matching "'+t+'"':n.length>0&&(i="Showing "+n.length+" elements matching addr= "+t+'"'),i+=", with lang="+o.options.lang,i+="undefined"!=typeof o.options.focus?", with focus="+o.options.focus:", without focus",o.options.debug&&console.log(i)}},onNavigateAfter:function(t,n,a,i,s,l){"undefined"==typeof i||"undefined"==typeof i.words?e(o.element).attr("aria-invalid",!0):e(o.element).attr("aria-invalid",!1)},onClickAfter:function(t,a,i,s){if(o.options.validation){var l=e(o.element).closest("form");if(l.length&&l.length>0){l.validate().element(".typeahead__w3w_valid"),e(o.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),e(o.element).closest(".typeahead__query").hasClass("valid")||e(o.element).closest(".typeahead__query").addClass("valid"),clearTimeout(n);var r=function(){e(o.element).closest(".typeahead__query").removeClass("valid")};n=setTimeout(r,500)}}"undefined"==typeof i||"undefined"==typeof i.words?e(o.element).attr("aria-invalid",!0):e(o.element).attr("aria-invalid",!1)},onCancel:function(t,n){o.options.validation&&e(o.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),e(o.element).attr("aria-invalid",!0)}}})},validation:function(){if(this.options.validation!==!1){this.options.debug&&console.log("Validating the w3wAddress field");var t=!1,n=this;e.validator.addMethod("w3w_valid",function(t,o){if(this.optional(o)||""===t.replace(/ /g,""))return!0;var a=!1,i=/^(\D{3,})\.(\D{3,})\.(\D{3,})$/i,s=i.exec(t);if(null!==s){var l=e(o).closest(".typeahead__container").find("span.typeahead__twa");if("undefined"!=typeof l&&l.length>0)for(var r=0;r<l.length&&!a;r++)l[r].innerText===t&&(a=!0);a||e.ajax({url:n._api_end_point+"forward",type:"GET",data:{addr:t,key:n.options.key,format:"json"},dataType:"json",success:function(e){var t=e;t.hasOwnProperty("geometry")&&(a=!0)}})}return a},function(){return t===!0?n.options.valid_country_error:n.options.valid_error}),e.validator.addClassRules("typeahead__w3w_valid",{w3w_valid:!0});var o,a=500,i=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i,s=e(this.element).closest("form");s.length&&s.length>0&&s.validate({onfocusout:!1,onkeyup:function(t){if(e(t).hasClass("typeahead__w3w_valid")){clearTimeout(o);var n=function(){e(t).closest(".typeahead__query").removeClass("valid"),i.test(e(t).val())&&e(t).valid()};o=setTimeout(n,a)}},errorPlacement:function(e,t){var n=t.closest(".typeahead__container");e.appendTo(n.siblings(".typeahead__w3w_validation"))}})}}}),e.fn.w3wAddress=function(o){return this.each(function(){e.data(this,"plugin_"+t)||e.data(this,"plugin_"+t,new n(this,o))}),this},e.fn.w3wAddress.defaults={country_filter:null,key:"",debug:!1,count:50,results:3,logo:!0,lang:"en",multilingual:!0,direction:"ltr",placeholder:"e.g. lock.spout.radar",validation:!0,valid_error:"Please enter a valid 3 word address.",typeaheadDelay:300}});
//# sourceMappingURL=jquery.w3w-autosuggest-plugin.min.js.map
