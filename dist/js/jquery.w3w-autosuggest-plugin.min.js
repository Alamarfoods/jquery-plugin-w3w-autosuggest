!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(jQuery)}(function(t){"use strict";var e="w3wAddress",n=function(n,o){this._api_end_point="https://api.what3words.com/v2/",this.element=n,this._name=e,this._defaults=t.fn.w3wAddress.defaults,this.options=t.extend({},this._defaults,o),this.init()};t.extend(n.prototype,{init:function(){this.buildWrappers(),this.autoSuggest(),this.validation()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildWrappers:function(){var e=this.options.direction;t(this.element).wrapAll('<div class="typeahead__container '+e+'"><div class="typeahead__field"><span class="typeahead__query"></span></div></div>'),t(this.element).closest(".typeahead__container").prepend('<img class="w3w-logo" src="https://assets.prod.what3words.com/images/w3w_grid-logo.svg" alt="w3w-logo">').after('<div class="w3w__validation"></div>'),t(this.element).addClass("w3w_valid").attr("placeholder",this.options.placeholder+" ").attr("autocomplete","off").attr("dir","auto")},bindEvents:function(){},unbindEvents:function(){this.$element.off("."+this._name)},callback:function(){var t=this.options.onComplete;"function"==typeof t&&t.call(this.element)},autoSuggest:function(){var e=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i;""===this.options.key&&this.options.debug?(console.log("No what3words API key found!"),alert("A what3words API key is required to use the AutoSuggest plugin. Information on how to register for a key can be found in the README")):this.options.debug&&console.log("what3words API key: "+this.options.key),"ar"===this.options.lang&&t(this.element).css("direction","rtl");var n=this,o=0;t.typeahead({debug:!0,input:t(this.element),minLength:5,compression:!0,hint:!0,emptyTemplate:!1,dynamic:!0,delay:700,maxItem:20,source:{autosuggest:{filter:function(e,i){var s=n.options.country_filter;return null!==s?(n.options.debug&&(console.log("w3wAddress country_filter: "),console.log(t(n.options.country_filter)),console.log("Selected Country is: "+s),console.log("#################################")),e.country===s&&(o<n.options.results&&(o++,!0))):o<n.options.results?(o++,!0):void 0},display:["words"],template:function(t,e){return['<div class="list-inner">','<span class="twa-flag"><img src="'+n.options.path_to_flags+'{{country}}.png"></span>','<span class="twa">{{words}}</span>',"<br>",'<span class="info">',"{{place}}</span>","</div>"].join("\n")},ajax:function(t){var o=e.exec(t);if(null!==o){var i={addr:"{{query}}",format:"json",key:n.options.key,count:n.options.count,display:"full"};"undefined"!=typeof n.options.lang&&n.options.lang&&(i.lang=n.options.lang),n.options.use_multilingual||"undefined"!=typeof i.lang||(i.lang="en");var s=n.options.use_multilingual?"autosuggest-ml":"autosuggest";return{type:"GET",url:n._api_end_point+s,data:i,path:"suggestions"}}return!1}}},callback:{onSearch:function(t,e){o=0},onInit:function(t){n.options.debug&&console.log("w3wAddress typeahead initiated on field: "+t.selector)},onResult:function(t,e,o,i){if(""!==e){var s="";0===o.length?s='No results matching "'+e+'"':o.length>0&&o.length<i?s="Showing "+o.length+" of "+i+' elements matching "'+e+'"':o.length>0&&(s="Showing "+o.length+" elements matching addr= "+e+'"'),s+=", with lang="+n.options.lang,s+="undefined"!=typeof n.options.focus?", with focus="+n.options.focus:", without focus",n.options.debug&&console.log(s)}},onClickAfter:function(e,o,i,s){n.options.validation&&(t(n.element).closest("form").validate().element(".w3w_valid"),t(n.element).closest(".typeahead__container").nextAll(".w3w__validation").empty(),t(n.element).closest(".typeahead__query").hasClass("valid")||t(n.element).closest(".typeahead__query").addClass("valid"))}}})},validation:function(){if(this.options.validation!==!1){this.options.debug&&console.log("Validating the w3wAddress field");var e=!1,n=this;t.validator.addMethod("w3w_valid",function(e,o){if(this.optional(o)||""===e.replace(/ /g,""))return!0;var i=!1,s=/^(\D{3,})\.(\D{3,})\.(\D{3,})$/i,a=s.exec(e);return null!==a&&t.ajax({url:n._api_end_point+"forward",type:"GET",async:!1,data:{addr:e,key:n.options.key,format:"json"},dataType:"json",success:function(t){var e=t;e.hasOwnProperty("geometry")&&(i=!0)}}),i},function(){return e===!0?n.options.valid_country_error:n.options.valid_error}),t.validator.addClassRules("w3w_valid",{w3w_valid:!0});var o,i=500,s=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i;t(this.element).closest("form").validate({onfocusout:!1,onkeyup:function(e){if(t(e).hasClass("w3w_valid")){clearTimeout(o);var n=function(){t(e).closest(".typeahead__query").removeClass("valid"),s.test(t(e).val())&&t(e).valid()};o=setTimeout(n,i)}},errorPlacement:function(t,e){var n=e.closest(".typeahead__container");t.appendTo(n.siblings(".w3w__validation"))}})}}}),t.fn.w3wAddress=function(o){return this.each(function(){t.data(this,"plugin_"+e)||t.data(this,"plugin_"+e,new n(this,o))}),this},t.fn.w3wAddress.defaults={country_filter:null,key:"",debug:!1,count:50,results:3,lang:null,use_multilingual:!0,direction:"ltr",placeholder:"e.g. lock.spout.radar",validation:!0,validate:!0,valid_error:"Please enter a valid 3 word address.",path_to_flags:"images/flags/"}});
//# sourceMappingURL=jquery.w3w-autosuggest-plugin.min.js.map
